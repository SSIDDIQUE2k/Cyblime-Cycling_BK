{% extends 'dashboard/base.html' %}

{% block dashboard_title %}My Events{% endblock %}
{% block dashboard_subtitle %}Your cycling events and activities{% endblock %}

{% block dashboard_content %}
<div class="dashboard-card">
    <div class="flex items-center justify-between mb-6">
        <h2 class="text-2xl font-bold text-gray-900">My Events</h2>
        <a href="{% url 'events:list' %}" class="inline-flex items-center px-3 py-2 bg-cyblime-blue text-white rounded-md text-sm hover:bg-blue-700">
            <i class="fas fa-search mr-2"></i>
            Browse Events
        </a>
    </div>

    <!-- Quick Stats -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
        <div class="stat-card">
            <div class="flex items-center">
                <div class="flex-1">
                    <p class="text-sm text-white opacity-80">Joined Upcoming</p>
                    <p class="text-3xl font-bold">{{ joined_upcoming_count }}</p>
                </div>
                <i class="fas fa-calendar-check text-2xl text-white opacity-60"></i>
            </div>
        </div>
        <div class="stat-card">
            <div class="flex items-center">
                <div class="flex-1">
                    <p class="text-sm text-white opacity-80">Joined Past</p>
                    <p class="text-3xl font-bold">{{ joined_past_count }}</p>
                </div>
                <i class="fas fa-history text-2xl text-white opacity-60"></i>
            </div>
        </div>
        <div class="stat-card">
            <div class="flex items-center">
                <div class="flex-1">
                    <p class="text-sm text-white opacity-80">My Created</p>
                    <p class="text-3xl font-bold">{{ created_count }}</p>
                </div>
                <i class="fas fa-plus-circle text-2xl text-white opacity-60"></i>
            </div>
        </div>
    </div>

    <!-- Tabs -->
    <div class="mb-4">
        <div class="inline-flex rounded-lg overflow-hidden border">
            <button data-tab="joined-upcoming" class="tab-btn px-4 py-2 bg-cyblime-blue text-white focus:outline-none">Joined Upcoming ({{ joined_upcoming_count }})</button>
            <button data-tab="joined-past" class="tab-btn px-4 py-2 bg-gray-100 text-gray-700 focus:outline-none">Joined Past ({{ joined_past_count }})</button>
            <button data-tab="created" class="tab-btn px-4 py-2 bg-gray-100 text-gray-700 focus:outline-none">My Created ({{ created_count }})</button>
        </div>
    </div>

    <!-- Tab: Joined Upcoming -->
    <div id="tab-joined-upcoming" class="tab-panel">
        {% if joined_upcoming %}
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                {% for event in joined_upcoming %}
                <div class="bg-white border rounded-lg p-4 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center mb-2 space-x-2">
                                <span class="inline-flex items-center px-2 py-1 text-xs font-medium rounded-full bg-cyblime-green text-white">
                                    <i class="fas fa-clock mr-1"></i> Upcoming
                                </span>
                                <span class="text-xs text-gray-500"><i class="far fa-calendar mr-1"></i>{{ event.date|date:"M j, Y g:i A" }}</span>
                            </div>
                            <h4 class="text-lg font-semibold text-gray-900">{{ event.title }}</h4>
                            <p class="text-gray-600 mt-1">{{ event.location }}</p>
                            <p class="text-gray-500 mt-2 text-sm">{{ event.description|truncatewords:20 }}</p>
                        </div>
                        <div class="ml-4 flex flex-col space-y-2">
                            <a href="{% url 'events:detail' event.pk %}" class="inline-flex items-center justify-center px-3 py-1.5 bg-cyblime-orange text-white rounded text-sm hover:bg-orange-600">
                                View
                            </a>
                            <form method="post" action="{% url 'events:leave' pk=event.pk %}">
                                {% csrf_token %}
                                <button type="submit" class="inline-flex items-center justify-center px-3 py-1.5 bg-red-600 text-white rounded text-sm hover:bg-red-700">Leave</button>
                            </form>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-10">
                <i class="fas fa-calendar text-4xl text-gray-300 mb-4"></i>
                <p class="text-gray-500">No upcoming joined events. Find one to join!</p>
                <a href="{% url 'events:list' %}" class="inline-block mt-3 bg-cyblime-blue text-white px-4 py-2 rounded hover:bg-blue-700">Browse Events</a>
            </div>
        {% endif %}
    </div>

    <!-- Tab: Joined Past -->
    <div id="tab-joined-past" class="tab-panel hidden">
        {% if joined_past %}
            <div class="space-y-4">
                {% for event in joined_past %}
                <div class="bg-white border rounded-lg p-4 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center mb-2 space-x-2">
                                <span class="inline-flex items-center px-2 py-1 text-xs font-medium rounded-full bg-gray-500 text-white">
                                    <i class="fas fa-history mr-1"></i> Past
                                </span>
                                <span class="text-xs text-gray-500"><i class="far fa-calendar mr-1"></i>{{ event.date|date:"M j, Y g:i A" }}</span>
                            </div>
                            <h4 class="text-lg font-semibold text-gray-900">{{ event.title }}</h4>
                            <p class="text-gray-600 mt-1">{{ event.location }}</p>
                        </div>
                        <div class="ml-4">
                            <a href="{% url 'events:detail' event.pk %}" class="inline-flex items-center justify-center px-3 py-1.5 bg-gray-500 text-white rounded text-sm hover:bg-gray-600">View</a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-10">
                <i class="fas fa-history text-4xl text-gray-300 mb-4"></i>
                <p class="text-gray-500">No past joined events yet.</p>
            </div>
        {% endif %}
    </div>

    <!-- Tab: My Created -->
    <div id="tab-created" class="tab-panel hidden">
        {% if created_events %}
            <div class="space-y-4">
                {% for event in created_events %}
                <div class="bg-white border rounded-lg p-4 hover:shadow-md transition-shadow">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center mb-2 space-x-2">
                                <span class="text-xs text-gray-500"><i class="far fa-calendar mr-1"></i>{{ event.date|date:"M j, Y g:i A" }}</span>
                            </div>
                            <h4 class="text-lg font-semibold text-gray-900">{{ event.title }}</h4>
                            <p class="text-gray-600 mt-1">{{ event.location }}</p>
                        </div>
                        <div class="ml-4 flex flex-col space-y-2">
                            <a href="{% url 'events:detail' event.pk %}" class="inline-flex items-center justify-center px-3 py-1.5 bg-cyblime-orange text-white rounded text-sm hover:bg-orange-600">View</a>
                            {% if user.is_staff %}
                                <a href="{% url 'events:edit' pk=event.pk %}" class="inline-flex items-center justify-center px-3 py-1.5 bg-cyblime-blue text-white rounded text-sm hover:bg-blue-700">Manage</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <div class="text-center py-10">
                <i class="fas fa-plus-circle text-4xl text-gray-300 mb-4"></i>
                <p class="text-gray-500">You haven't created any events yet.</p>
                {% if user.is_staff %}
                    <a href="{% url 'events:create' %}" class="inline-block mt-3 bg-cyblime-green text-white px-4 py-2 rounded hover:bg-green-600">Create Event</a>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>

<script>
// Simple tab switcher
(function() {
  const btns = document.querySelectorAll('.tab-btn');
  const panels = {
    'joined-upcoming': document.getElementById('tab-joined-upcoming'),
    'joined-past': document.getElementById('tab-joined-past'),
    'created': document.getElementById('tab-created')
  };
  btns.forEach(btn => {
    btn.addEventListener('click', () => {
      const tab = btn.getAttribute('data-tab');
      // toggle btn styles
      btns.forEach(b => b.classList.remove('bg-cyblime-blue','text-white'));
      btns.forEach(b => b.classList.add('bg-gray-100','text-gray-700'));
      btn.classList.add('bg-cyblime-blue','text-white');
      btn.classList.remove('bg-gray-100','text-gray-700');
      // toggle panels
      Object.keys(panels).forEach(key => panels[key].classList.add('hidden'));
      panels[tab].classList.remove('hidden');
    });
  });
})();
</script>
{% endblock %}
