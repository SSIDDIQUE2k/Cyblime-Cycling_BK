{% extends 'base.html' %}

{% block title %}Dashboard - {{ user.username }} | Cyblime Cycling Club{% endblock %}

{% block extra_css %}
<style>
    .dashboard-sidebar {
        background: linear-gradient(135deg, #20B2AA 0%, #0b0f27 100%);
        min-height: calc(100vh - 64px);
    }
    
    /* Replaced Tailwind @apply with plain CSS so it works with CDN setup */
    .dashboard-nav-item {
        display: block;
        padding: 0.75rem 1rem;
        color: #ffffff;
        border-radius: 0.5rem;
        margin: 0.25rem 0.5rem;
        transition: background-color 0.2s ease, opacity 0.2s ease;
        position: relative;
    }
    .dashboard-nav-item:hover {
        background: rgba(255, 255, 255, 0.10);
    }
    .dashboard-nav-item.active {
        background: rgba(255, 255, 255, 0.20);
        font-weight: 600;
    }
    .dashboard-nav-item.active::before {
        content: "";
        position: absolute;
        left: 0.25rem;
        top: 0.5rem;
        bottom: 0.5rem;
        width: 3px;
        border-radius: 9999px;
        background: rgba(255,255,255,0.85);
    }

    .dashboard-card {
        background: #ffffff;
        border-radius: 0.5rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
        padding: 1.5rem;
        transition: box-shadow 0.2s ease;
    }
    .dashboard-card:hover {
        box-shadow: 0 10px 15px rgba(0,0,0,0.10), 0 4px 6px rgba(0,0,0,0.05);
    }

    .stat-card {
        background-image: linear-gradient(135deg, #20B2AA, #FF8C00);
        color: #ffffff;
        border-radius: 0.5rem;
        padding: 1.5rem;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
    }
    .dashboard-sidebar { transition: width 0.2s ease; }
    .dashboard-sidebar .brand-label { display: block; }
    .dashboard-sidebar .nav-label { display: inline; }
    .dashboard-sidebar.sidebar-collapsed { width: 4rem !important; }
    .dashboard-sidebar.sidebar-collapsed .brand-label { display: none; }
    .dashboard-sidebar.sidebar-collapsed .section-title { display: none; }
    .dashboard-sidebar.sidebar-collapsed .dashboard-nav-item { text-align: center; padding-left: 0.75rem; padding-right: 0.75rem; }
    .dashboard-sidebar.sidebar-collapsed .dashboard-nav-item i { margin-right: 0; }
    .dashboard-sidebar.sidebar-collapsed .dashboard-nav-item .nav-label { display: none; }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50">
    <div class="flex">
        <!-- Sidebar -->
        <div id="dashboard-sidebar" class="w-64 dashboard-sidebar overflow-y-auto">
            <div class="p-6">
                <div class="flex items-center mb-8">
                    <img src="/static/images/cyblime-logo.svg" alt="Cyblime Logo" class="h-10 w-10 mr-3">
                    <div class="brand-label">
                        <h2 class="text-white font-bold text-lg">Dashboard</h2>
                        <p class="text-gray-300 text-sm">{{ user.username }}</p>
                    </div>
                </div>
                
                <!-- Navigation Menu -->
                <nav class="space-y-1">
                    <div class="section-title px-4 text-xs uppercase tracking-wider text-white/70 mt-2 mb-1">Main</div>
                    <a href="{% url 'dashboard:overview' %}" 
                       title="Overview"
                       class="dashboard-nav-item {% if request.resolver_match.url_name == 'overview' %}active{% endif %}">
                        <i class="fas fa-tachometer-alt mr-3"></i>
                        <span class="nav-label">Overview</span>
                    </a>
                    
                    <a href="{% url 'dashboard:events' %}" 
                       title="My Events"
                       class="dashboard-nav-item {% if request.resolver_match.url_name == 'events' %}active{% endif %}">
                        <i class="fas fa-calendar mr-3"></i>
                        <span class="nav-label">My Events</span>
                    </a>
                    
                    <a href="{% url 'dashboard:posts' %}" 
                       title="My Posts"
                       class="dashboard-nav-item {% if request.resolver_match.url_name == 'posts' %}active{% endif %}">
                        <i class="fas fa-edit mr-3"></i>
                        <span class="nav-label">My Posts</span>
                    </a>
                    
                    <a href="{% url 'dashboard:gallery' %}" 
                       title="My Gallery"
                       class="dashboard-nav-item {% if request.resolver_match.url_name == 'gallery' %}active{% endif %}">
                        <i class="fas fa-images mr-3"></i>
                        <span class="nav-label">My Gallery</span>
                    </a>
                    
                    <a href="{% url 'dashboard:stats' %}" 
                       title="Statistics"
                       class="dashboard-nav-item {% if request.resolver_match.url_name == 'stats' %}active{% endif %}">
                        <i class="fas fa-chart-bar mr-3"></i>
                        <span class="nav-label">Statistics</span>
                    </a>

                    <div class="section-title px-4 text-xs uppercase tracking-wider text-white/70 mt-4 mb-1">Account</div>
                    <a href="{% url 'dashboard:profile' %}" 
                       title="Profile"
                       class="dashboard-nav-item {% if request.resolver_match.url_name == 'profile' %}active{% endif %}">
                        <i class="fas fa-user mr-3"></i>
                        <span class="nav-label">Profile</span>
                    </a>
                    
                    <a href="{% url 'dashboard:settings' %}" 
                       title="Settings"
                       class="dashboard-nav-item {% if request.resolver_match.url_name == 'settings' %}active{% endif %}">
                        <i class="fas fa-cog mr-3"></i>
                        <span class="nav-label">Settings</span>
                    </a>
                    
                    <div class="border-t border-white border-opacity-20 my-4"></div>
                    
                    <div class="section-title px-4 text-xs uppercase tracking-wider text-white/70 mt-2 mb-1">Shortcuts</div>
                    <a href="{% url 'blog:create' %}" 
                       title="Create Post"
                       class="dashboard-nav-item">
                        <i class="fas fa-plus-circle mr-3"></i>
                        <span class="nav-label">Create Post</span>
                    </a>
                    {% if user.is_staff %}
                    <a href="{% url 'events:create' %}" 
                       title="Create Event"
                       class="dashboard-nav-item">
                        <i class="fas fa-calendar-plus mr-3"></i>
                        <span class="nav-label">Create Event</span>
                    </a>
                    {% endif %}
                    <a href="{% url 'events:list' %}" 
                       title="Browse Events"
                       class="dashboard-nav-item">
                        <i class="fas fa-bicycle mr-3"></i>
                        <span class="nav-label">Browse Events</span>
                    </a>
                    
                    <div class="border-t border-white border-opacity-20 my-4"></div>
                    
                    <a href="{% url 'core:home' %}" 
                       title="Back to Site"
                       class="dashboard-nav-item">
                        <i class="fas fa-arrow-left mr-3"></i>
                        <span class="nav-label">Back to Site</span>
                    </a>
                </nav>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="flex-1">
            <!-- Header -->
            <div class="bg-white shadow-sm border-b px-6 py-4">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-3">
                        <button id="sidebar-toggle" class="inline-flex items-center justify-center h-10 w-10 rounded-lg text-gray-600 hover:text-gray-900 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-cyblime-blue" aria-label="Toggle sidebar">
                            <i class="fas fa-bars"></i>
                        </button>
                        <div>
                            <h1 class="text-2xl font-bold text-gray-900">
                                {% block dashboard_title %}Dashboard{% endblock %}
                            </h1>
                            <p class="text-gray-600">
                                {% block dashboard_subtitle %}Welcome back, {{ user.first_name|default:user.username }}!{% endblock %}
                            </p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <!-- User info -->
                        <div class="text-right">
                            <p class="text-sm text-gray-600">{{ user.email }}</p>
                            <p class="text-xs text-gray-400">Member since {{ user.date_joined|date:"M Y" }}</p>
                        </div>
                        
                        <!-- Profile picture or avatar -->
                        <div class="w-10 h-10 bg-cyblime-teal rounded-full flex items-center justify-center text-white font-semibold">
                            {{ user.username|slice:":1"|upper }}
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Dashboard Content -->
            <div class="p-6">
                {% if messages %}
                    <div class="mb-6">
                        {% for message in messages %}
                            <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4">
                                {{ message }}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
                
                {% block dashboard_content %}{% endblock %}
            </div>
        </div>
</div>
</div>

<script>
// Sidebar toggle with persistence
(function() {
  const sidebar = document.getElementById('dashboard-sidebar');
  const toggle = document.getElementById('sidebar-toggle');
  if (sidebar && localStorage.getItem('dashboardSidebarCollapsed') === '1') {
    sidebar.classList.add('sidebar-collapsed');
  }
  if (toggle && sidebar) {
    toggle.addEventListener('click', function() {
      sidebar.classList.toggle('sidebar-collapsed');
      const collapsed = sidebar.classList.contains('sidebar-collapsed') ? '1' : '0';
      localStorage.setItem('dashboardSidebarCollapsed', collapsed);
    });
  }
})();
</script>
{% endblock %}
